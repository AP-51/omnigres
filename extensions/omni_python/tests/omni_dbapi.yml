$schema: "https://raw.githubusercontent.com/omnigres/omnigres/master/pg_yregress/schema.json"
instance:
  init:
  - create extension omni_python cascade
  - insert
    into
        omni_python.config (name, value)
    values
        ('pip_find_links', '../../../python-wheels'),
        ('site_packages', 'omni_python_test_functions')
  - select omni_python.install_requirements('omni_python')

tests:

- name: simple connect
  steps:
  - query: select * from omni_python.create_functions($1)
    params:
    #language=Python
    - |
      from omni_python import pg, dbapi

      @pg
      def get_one() -> int:
          conn = dbapi.connect();
          cur = conn.cursor()
          cur.execute('SELECT 1')
          res = cur.fetchone()
          conn.close()
          return res[0]
  - query: select get_one() as res
    results:
     - res: 1
